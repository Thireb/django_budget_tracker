{% extends 'material/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 d-flex align-items-center">
                        <i class="material-icons me-2">edit</i>
                        Edit Category: {{ category.name }}
                    </h5>
                    <a href="{% url 'category_list' %}" class="btn btn-raised btn-secondary btn-sm">
                        <i class="material-icons">arrow_back</i> Back to Categories
                    </a>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        <div class="form-group mb-3">
                            <label for="{{ form.name.id_for_label }}" class="bmd-label-floating">Name</label>
                            {{ form.name }}
                            {% if form.name.errors %}
                                <div class="text-danger small">{{ form.name.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted">
                                <i class="material-icons">info</i>
                                Enter a unique category name
                            </small>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="{{ form.description.id_for_label }}" class="bmd-label-floating">Description</label>
                            {{ form.description }}
                            {% if form.description.errors %}
                                <div class="text-danger small">{{ form.description.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted">
                                <i class="material-icons">description</i>
                                Provide a brief description of what this category represents
                            </small>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="{{ form.icon.id_for_label }}" class="bmd-label-floating d-flex align-items-center">
                                Icon
                                <i class="material-icons ms-2" id="icon-preview" style="color: {{ category.color }}">
                                    {% if category.icon == 'fa-home' %}home
                                    {% elif category.icon == 'fa-car' %}directions_car
                                    {% elif category.icon == 'fa-utensils' %}restaurant
                                    {% else %}category{% endif %}
                                </i>
                            </label>
                            {{ form.icon }}
                            {% if form.icon.errors %}
                                <div class="text-danger small">{{ form.icon.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted">
                                <i class="material-icons">palette</i>
                                Choose an icon that best represents this category
                            </small>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label for="{{ form.color.id_for_label }}" class="bmd-label-floating">Color</label>
                            {{ form.color }}
                            {% if form.color.errors %}
                                <div class="text-danger small">{{ form.color.errors }}</div>
                            {% endif %}
                            <small class="form-text text-muted">
                                <i class="material-icons">format_color_fill</i>
                                Select a color for visual identification
                            </small>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <button type="submit" class="btn btn-raised btn-primary">
                                <i class="material-icons">save</i> Save Changes
                            </button>
                            <a href="{% url 'category_list' %}" class="btn btn-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Preview Card -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="material-icons">preview</i>
                        Live Preview
                    </h5>
                </div>
                <div class="card-body">
                    <div class="card" id="preview-card" style="border-left: 5px solid {{ category.color }}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title d-flex align-items-center mb-0">
                                    <i class="material-icons preview-icon" style="color: {{ category.color }}">category</i>
                                    <span class="ms-2 preview-name">{{ category.name }}</span>
                                </h5>
                            </div>
                            <p class="card-text text-muted small mt-2">
                                <i class="material-icons">description</i>
                                <span class="preview-description">{{ category.description|default:"No description provided" }}</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Material Design components
    $('body').bootstrapMaterialDesign();
    
    // Icon mapping from Font Awesome to Material Icons
    const iconMapping = {
        'fa-home': 'home',
        'fa-car': 'directions_car',
        'fa-utensils': 'restaurant',
        'fa-shopping-cart': 'shopping_cart',
        'fa-medical-kit': 'medical_services',
        'fa-graduation-cap': 'school',
        'fa-plane': 'flight',
        'fa-gamepad': 'sports_esports',
        'fa-gift': 'card_giftcard'
    };

    // Form elements
    const nameInput = document.getElementById('{{ form.name.id_for_label }}');
    const descInput = document.getElementById('{{ form.description.id_for_label }}');
    const iconInput = document.getElementById('{{ form.icon.id_for_label }}');
    const colorInput = document.getElementById('{{ form.color.id_for_label }}');
    
    // Add material form classes
    document.querySelectorAll('.form-control').forEach(input => {
        input.closest('.form-group').classList.add('bmd-form-group');
        if (input.value) {
            input.classList.add('is-filled');
        }
    });

    // Initialize Pickr color picker
    const pickr = Pickr.create({
        el: colorInput,
        theme: 'classic',
        default: '{{ category.color }}',
        components: {
            preview: true,
            opacity: true,
            hue: true,
            interaction: {
                hex: true,
                rgba: true,
                input: true,
                save: true
            }
        },
        swatches: [
            '#2196F3', '#4CAF50', '#F44336', '#FFC107', '#9C27B0',
            '#00BCD4', '#FF9800', '#795548', '#607D8B', '#E91E63'
        ]
    });

    // Update color on pickr change
    pickr.on('change', color => {
        const hexColor = color.toHEXA().toString();
        colorInput.value = hexColor;
        previewIcon.style.color = hexColor;
        iconPreview.style.color = hexColor;
        previewCard.style.borderLeftColor = hexColor;
        
        // Add ripple effect to preview card
        const ripple = document.createElement('div');
        ripple.className = 'ripple';
        ripple.style.backgroundColor = hexColor;
        previewCard.appendChild(ripple);
        setTimeout(() => ripple.remove(), 1000);
    });

    // Add material ripple effect to buttons
    document.querySelectorAll('.btn').forEach(button => {
        button.addEventListener('click', function(e) {
            const ripple = document.createElement('div');
            ripple.className = 'ripple';
            this.appendChild(ripple);
            setTimeout(() => ripple.remove(), 1000);
        });
    });
});
</script>
{% endblock %} 